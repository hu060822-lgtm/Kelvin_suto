<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å–€çˆ¾æ–‡ï¼šæ ¸å¿ƒä¿è¡›æˆ° v3.2</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: sans-serif; touch-action: manipulation; }
        #game-stage { position: relative; width: 100vw; height: 100vh; background: radial-gradient(circle, #222 0%, #000 80%); overflow: hidden; }
        #safe-zone { position: absolute; top: 50%; left: 50%; width: 60px; height: 60px; margin: -30px 0 0 -30px; background: #f1c40f; border-radius: 50%; box-shadow: 0 0 30px #f1c40f; z-index: 10; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; color: #000; }
        .calvin-enemy { position: absolute; border-radius: 50%; border: 2px solid #fff; background-size: cover; background-position: center; z-index: 5; transition: transform 0.1s; }
        .boss { border: 4px solid #f1c40f; box-shadow: 0 0 15px #f1c40f; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; color: white; text-align: center; padding: 20px; box-sizing: border-box; }
        #info-ui { position: absolute; top: 20px; width: 100%; text-align: center; color: white; z-index: 20; pointer-events: none; }
        .btn { padding: 15px 50px; background: #e74c3c; color: white; border: none; border-radius: 50px; font-size: 20px; font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="game-stage">
        <div id="info-ui">
            <div id="score-text" style="font-size:24px;">æ“Šé€€æ¬¡æ•¸: 0</div>
            <div id="timer-text">ç”Ÿå­˜æ™‚é–“: 0s</div>
            <div id="mode-text" style="color:#ff4757; font-weight:bold;"></div>
        </div>
        <div id="safe-zone">SAFE</div>
    </div>

    <div id="start-ui" class="overlay">
        <h1 style="color:#f1c40f">å–€çˆ¾æ–‡ä¿è¡›æˆ° v3.2</h1>
        <div style="text-align: left; background: #222; padding: 20px; border-radius: 15px; font-size: 15px; max-width: 300px;">
            <p>ğŸ›¡ï¸ <b>é˜²ç¦¦ï¼š</b>é»æ“Šå–€çˆ¾æ–‡æ“Šé€€ä»–å€‘ã€‚</p>
            <p>ğŸ‘¹ <b>å·¨å‹å–€çˆ¾æ–‡ï¼š</b>é‡‘è‰²é‚Šæ¡†çš„å‚¢ä¼™è¦é» 3 æ¬¡ï¼</p>
            <p>ğŸŒ€ <b>30ç§’å¾Œï¼š</b>å–€çˆ¾æ–‡å°‡æœƒé–‹å§‹è›‡è¡Œç§»å‹•ã€‚</p>
        </div>
        <button class="btn" onclick="realStart()">ç«‹å³é–‹æˆ°</button>
    </div>

    <div id="end-ui" class="overlay" style="display:none">
        <h1 style="color:#ff4757; font-size: 40px;">é˜²ç·šå¤±å®ˆï¼</h1>
        <p id="final-stat"></p>
        <button class="btn" onclick="location.reload()">é‡æ–°æ•´å‚™</button>
    </div>

    <script>
        let score = 0, isGameOver = true, startTime, baseSpeed = 1.3, spawnRate = 1200;
        const stage = document.getElementById('game-stage');

        function realStart() {
            document.getElementById('start-ui').remove();
            isGameOver = false;
            startTime = Date.now();
            updateStats();
            spawnLoop();
        }

        function updateStats() {
            if (isGameOver) return;
            const sec = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById('timer-text').innerText = `ç”Ÿå­˜æ™‚é–“: ${sec}s`;
            
            baseSpeed = 1.3 + (sec / 6) * 0.4;
            spawnRate = Math.max(350, 1200 - (sec * 15));

            if (sec >= 30) {
                document.getElementById('mode-text').innerText = "âš ï¸ ç˜‹ç‹‚è›‡è¡Œæ¨¡å¼ âš ï¸";
            }
            setTimeout(updateStats, 1000);
        }

        function createEnemy() {
            if (isGameOver) return;
            const enemy = document.createElement('div');
            const isBoss = Math.random() < 0.15; // 15% æ©Ÿç‡å‡ºç¾ BOSS
            
            enemy.className = 'calvin-enemy' + (isBoss ? ' boss' : '');
            enemy.style.backgroundImage = "url('12672.jpg')";
            
            const size = isBoss ? 150 : 65;
            enemy.style.width = size + 'px';
            enemy.style.height = size + 'px';
            enemy.dataset.hp = isBoss ? 3 : 1;

            let x, y, side = Math.floor(Math.random() * 4);
            if (side === 0) { x = Math.random() * innerWidth; y = -size; }
            else if (side === 1) { x = innerWidth + size; y = Math.random() * innerHeight; }
            else if (side === 2) { x = Math.random() * innerWidth; y = innerHeight + size; }
            else { x = -size; y = Math.random() * innerHeight; }

            enemy.dataset.x = x;
            enemy.dataset.y = y;
            enemy.dataset.seed = Math.random() * 10;
            
            const hit = (e) => { e.preventDefault(); e.stopPropagation(); repel(enemy); };
            enemy.addEventListener('touchstart', hit);
            enemy.addEventListener('mousedown', hit);

            stage.appendChild(enemy);
            moveEnemy(enemy, size/2);
        }

        function moveEnemy(enemy, radius) {
            let t = 0;
            const timer = setInterval(() => {
                if (isGameOver || !enemy.parentNode) return clearInterval(timer);
                
                const sec = (Date.now() - startTime) / 1000;
                const tx = innerWidth / 2 - radius, ty = innerHeight / 2 - radius;
                let cx = parseFloat(enemy.dataset.x), cy = parseFloat(enemy.dataset.y);
                
                const dx = tx - cx, dy = ty - cy;
                const d = Math.sqrt(dx*dx + dy*dy);

                if (d < 30) { gameOver(); return clearInterval(timer); }

                // è¨ˆç®—ç§»å‹•å‘é‡
                let vx = (dx/d) * baseSpeed;
                let vy = (dy/d) * baseSpeed;

                // 30ç§’å¾Œè›‡è¡Œ (ä¿®æ­£ä¸æœƒå‹•çš„Bug)
                if (sec >= 30) {
                    const drift = Math.sin(t * 0.1) * (baseSpeed * 1.5);
                    const nx = -(dy/d) * drift;
                    const ny = (dx/d) * drift;
                    vx += nx;
                    vy += ny;
                }

                enemy.dataset.x = cx + vx;
                enemy.dataset.y = cy + vy;
                enemy.style.left = enemy.dataset.x + 'px';
                enemy.style.top = enemy.dataset.y + 'px';
                t++;
            }, 20);
        }

        function repel(enemy) {
            let hp = parseInt(enemy.dataset.hp) - 1;
            enemy.dataset.hp = hp;
            
            // æ‰“æ“Šè¦–è¦ºåé¥‹
            enemy.style.transform = "scale(0.8)";
            setTimeout(() => { if(!isGameOver) enemy.style.transform = "scale(1)"; }, 50);

            if (hp <= 0) {
                score++;
                document.getElementById('score-text').innerText = `æ“Šé€€æ¬¡æ•¸: ${score}`;
                enemy.style.transform = "scale(0)";
                enemy.style.opacity = "0";
                setTimeout(() => { if(enemy.parentNode) stage.removeChild(enemy); }, 200);
            }
        }

        function spawnLoop() {
            if (!isGameOver) {
                createEnemy();
                setTimeout(spawnLoop, spawnRate);
            }
        }

        function gameOver() {
            if (isGameOver) return;
            isGameOver = true;
            document.getElementById('end-ui').style.display = 'flex';
            document.getElementById('final-stat').innerText = `é˜²ç¦¦äº† ${score} æ¬¡ï¼Œå …æŒäº† ${Math.floor((Date.now()-startTime)/1000)} ç§’`;
            stage.style.filter = "grayscale(1) brightness(0.5)";
        }
    </script>
</body>
</html>
